---
layout: post
title: "ISUCON本_Ch3"
date: 2023-09-18
category: ISUCON
excerpt: ""
---
# Ch3. 基本的な負荷試験

## TL;DR


## Q
- 負荷試験とは何か
- 負荷試験はどのようにするのか
- 負荷試験のためのツールは何があるのか
- nginxのアクセスログで何がわかるのか
- alpとは何か
- abコマンドとは何か
- スロークエリログとは何か

## R
### 負荷試験とは何か
- Webサービスの性能を測る指標
- 負荷試験を行うアプリケーションのことを**ベンチマーカー**という

### 負荷試験はどのようにするのか
- 負荷試験用の環境を作り、そこでベンチマーカを実行する
  - 同じ環境でベンチマーカーを実行しても良いが、サービスのチューニングが進み、リクエスト数が増えるとベンチマーカーによる負荷が大きくなるので、なるべく別の環境で実行した方がいい

### 性能を測る方法
- nginxのアクセスログを集計

### nginxのアクセスログで何がわかるのか
- 各URLのレスポンスタイム(=**レイテンシ**)の計測ができる
  - Webサーバーにリクエストが飛んだ時刻と、アプリサーバーからWebサーバにレスポンスが返ってきた時刻から算出できる
- アクセスログはデフォルトだとcombinedという形式で保存される
  - このままだと使いずらいので、JSONに加工してから使われることが多い
  - nginxの設定ファイルでlog_formatディレクティブを変えることで対応可能
  - `log_format json escape=json{必要な情報}`

### alpとは何か
- アクセスログを集計・解析することができるツール
  - JSON,LTSV形式に対応している
- URIやリクエストメソッドごとに次の情報を取得できる
  - ステータスコードごとのレスポンス回数
  - レスポンスタイムの最小・最大・平均・合計・パーセンタイル値
  - 返却したレスポンスサイズ（byte)の最小・最大・平均・合計
- brew install alpでインストール可能

### abコマンドとは何か
- Apache HTTP Serverに付属する、HTTPベンチマーカー用のコマンド
- 単一のURIに対してリクエストを送信する
- `apt install apache2-utils`でインストールできる

### アクセスログのローテーションとは何か
- ログファイルをファイルシステム上で別名に変更すること
  - 負荷試験実行ごとにログファイルを変えないと、どの負荷試験の結果について分析しているかがわからなくなるため
- 2つの方法がある


### スロークエリログとは何か


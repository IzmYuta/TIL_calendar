---
layout: post
title: "ISUCON本_Ch5"
date: 2023-09-23
category: ISUCON
excerpt: ""
---
# Ch5. データベースのチューニング
## TL;DR
- Webサービスの高速化において、DBのチューニングは最も重要な要素である
- ISUCONにおいても、スコアを伸ばすためにはまずDBのチューニングから行う


## Q
- データベースをどのように改善して高速化するのか
- NewSQLとは何か
- DBの負荷計測はどのようにするのか
- インデックスとは何か
- プリペアドステートメントとは何か
- 接続の永続化とは何か

## R

### NewSQLとは

### 各種DBの特徴
- RDBMS：一貫性
- NoSQL：自由な形式・高速
- NewSQL：RDBMSとNoSQL両方の性質を併せ持つ

基本はRDBMSを使い、ピンポイントでNoSQLでデータ構造を構成する

### DBの負荷計測
- OSから負荷計測する
  - topコマンドを使ってCPU使用率をみる
- MySQLのプロセスリストを見る
  - `SHOW PROCESSLIST`でMySQLのスレッドが処理している内容が確認できる
  - `State`が`Sending data`となっているクエリがないか注意する(大量のデータをディスクやメモリから読み取っている可能性があるため)
- pt-query-digestによるスロークエリログの分析
  - Percona社がリリースしている、Percona Toolkit(＝MySQLの運用・監視・分析に役立つツール群)に含まれるツールの一つ
  - mysqldumpslowコマンドよりも詳しい分析ができる
  - Debian/Ubuntu系OSではaptコマンドでインストールできる
 
### インデックスとは
- インデックス...索引
- DBでいうインデックスとは、**二分探索**である
  - **Bツリー**という構造が取られることが多い
  - インデックスを付与することで、二分探索を利用して検索することができるようになる
- MySQLでは、EXPLAINステートメントを利用することで、クエリがどのインデックスを利用してデータを取得するかを見ることができる
  - **オプティマイザ**と呼ばれる機能が、どのインデックスを利用するかを決定している
  - OPTIMIZER_TRACEを利用することでより詳しい情報が得られる

後ほどインデックスについて単体でページを作成する

### プリペアドステートメントとは
- 変数を埋め込み可能な形のSQLを発行し、DB側でキャッシュする
  - アプリケーション側から変数を送るだけでSQLを発行することができるので、DBの効率が上がる
  - 
